\nonumchapter{Anexo}
\def\baselinestretch{1.0}
\medskip

\section*{Rutinas para R}
\begin{verbatim}
#########################################################################
library(dtw)

##########################Base de datos AFP################################
X<-matrix(0,ncol=7,nrow=170)
X<-read.table(file='C:/Users/Juan Carlos Herrera/
Documents/Seminario de Tesis/Datos afp.txt')
X<-as.matrix(X)
ts.plot(X,gpars=list(xlab="Tiempo", ylab="",main="Rentabilidad AFP" ))
boxplot(as.data.frame(X))
##################################################################################

X<-read.table(file='C:/Users/Juan Carlos Herrera/Documents
/Seminario de Tesis/Datos_CUPRUM.txt')
X<-as.matrix(X)

########################Vectorizamos###################################################
l<-dim(X)[1]
v1<-matrix(0,nrow=l,ncol=1)
v2<-matrix(0,nrow=l,ncol=1)
v3<-matrix(0,nrow=l,ncol=1)
v4<-matrix(0,nrow=l,ncol=1)
v5<-matrix(0,nrow=l,ncol=1)
v6<-matrix(0,nrow=l,ncol=1)
v7<-matrix(0,nrow=l,ncol=1)

for(i in 1:l)
  {
   v1[i]<-X[i,1]
   v2[i]<-X[i,2]
   v3[i]<-X[i,3]
   v4[i]<-X[i,4]
   v5[i]<-X[i,5]
   v6[i]<-X[i,6]
   v7[i]<-X[i,7]
   }
##############################################################
#####Algunas funciones para calcular distancia######################
########Distancia Euclidiana#####################################
de<-function(a,b)
{
n<-length(a)
s<-0
vec<-matrix(0,n,1)
for(i in 1:n)
 {
   vec[i]<-(a[i]-b[i])^2
   s<-sqrt(sum(vec))
 }
s
}
################Distancia de Frechet##########################################
d<-function(a,b)
{
c<-abs(a-b)
c
}

x<-c(1.4,2.3,3.09,4.3,1.3)
y<-c(6.02,7.1,9.01,0,1,6,2.1,3.3)

df<-function(x,y)
{
p<-length(x)
q<-length(y)
ca<-matrix(-1,nrow=p,ncol=q)
c<-matrix(0,nrow=p,ncol=q)
ca[1,1]<-d(x[1],y[1])
k<-1
l<-1
s<-0
for(i in 2:p)
{
ca[i,k]<-max(ca[i-1,k],d(x[i],y[k]))
}
for(j in 2:q)
{
ca[l,j]<-max(ca[l,j-1],d(x[l],y[j]))
}
 for(i in 2:p)
 {
  for(j in 2:q)
  {
   ca[i,j]<-min(max(ca[i-1,j],ca[i-1,j-1],ca[i,j-1]),d(x[i],y[j]))
  }
 }
  for(i in 1:p)
  {
   for(j in 1:q)
   {
   if(ca[i,j]>-1)
   {
   a<-ca[i,j]
   a
   }
  else
  {
  s<-100000
  s
  }
}
}
a
}

###########################Coeficiente de Codispersion#################

cod<-function(a,b,h)
{
n<-length(a)
m<-length(b)
vec<-matrix(0,n,1)
vec1<-matrix(0,n,1)
vec2<-matrix(0,n,1)
s1<-0
s2<-0
s3<-0
r<-0
  for(i in 1:n-h)
     {
      vec[i]=(a[i+h]-a[i])*(b[i+h]-b[i])
      vec1[i]=(a[i+h]-a[i])^2
      vec2[i]=(b[i+h]-b[i])^2
      s1<-sum(vec)
      s2<-sqrt(sum(vec1))
      s3<-sqrt(sum(vec2))
     }
r<-(s1/(s2*s3))
r
}
##########################Indice de disimilaridad######################
D<-function(a,b,h,k)
{
l<-length(a)
p1<-cod(a,b,h)
p2<-de(a,b)/(l)
v<-(2/(1+exp(p1*k)))
f<-(v*p2)
f
}

########################################################################

D1<-function(a,b,h,k)
{
l<-length(a)
p1<-cod(a,b,h)
p2<-dtw(a,b)$distance/(l)
v<-(2/(1+exp(k*p1)))
f<-(v*p2)
f
}

################################################################################

D2<-function(a,b,h,k)
{
l<-length(a)
p1<-cod(a,b,h)
p2<-df(a,b)/l
v<-(2/(1+exp(k*p1)))
f<-(v*p2)
f
}

#######################Funcion de disimilaridad que transforma matriz de
distancia en objeto dist##############################################
#h=h1
#t=h2
#k=k

cl<-function(A,B,C,V,E,F,G,h,k)
{
a<-D(A,B,h,k)
b<-D(A,C,h,k)
y<-D(A,V,h,k)
d<-D(A,E,h,k)
m<-D(A,F,h,k)
l<-D(A,G,h,k)
e<-D(B,C,h,k)
g<-D(B,V,h,k)
h<-D(B,E,h,k)
o<-D(B,F,h,k)
p<-D(B,G,h,k)
q<-D(C,V,h,k)
z<-D(C,E,h,k)
t<-D(C,F,h,k)
u<-D(C,G,h,k)
n<-D(V,E,h,k)
r<-D(V,F,h,k)
s<-D(V,G,h,k)
w<-D(E,F,h,k)
f1<-D(E,G,h,k)
w1<-D(F,G,h,k)

A1<-matrix(c(0,a,b,y,d,m,l),7,1)
B2<-matrix(c(a,0,e,g,h,o,p),7,1)
C3<-matrix(c(b,e,0,q,z,t,u),7,1)
D4<-matrix(c(y,g,q,0,n,r,s),7,1)
P5<-matrix(c(d,h,z,n,0,w,f1),7,1)
P6<-matrix(c(m,o,t,r,w,0,w1),7,1)
P7<-matrix(c(l,p,u,s,f1,w1,0),7,1)


MD<-matrix(cbind(A1,B2,C3,D4,P5,P6,P7),7,7)
md<-as.dist(MD)
md
}

############################################################

cl1<-function(A,B,C,V,E,F,G,h,k)
{
a<-D1(A,B,h,k)
b<-D1(A,C,h,k)
y<-D1(A,V,h,k)
d<-D1(A,E,h,k)
m<-D1(A,F,h,k)
l<-D1(A,G,h,k)
e<-D1(B,C,h,k)
g<-D1(B,V,h,k)
h<-D1(B,E,h,k)
o<-D1(B,F,h,k)
p<-D1(B,G,h,k)
q<-D1(C,V,h,k)
z<-D1(C,E,h,k)
t<-D1(C,F,h,k)
u<-D1(C,G,h,k)
n<-D1(V,E,h,k)
r<-D1(V,F,h,k)
s<-D1(V,G,h,k)
w<-D1(E,F,h,k)
f1<-D1(E,G,h,k)
w1<-D1(F,G,h,k)

A1<-matrix(c(0,a,b,y,d,m,l),7,1)
B2<-matrix(c(a,0,e,g,h,o,p),7,1)
C3<-matrix(c(b,e,0,q,z,t,u),7,1)
D4<-matrix(c(y,g,q,0,n,r,s),7,1)
P5<-matrix(c(d,h,z,n,0,w,f1),7,1)
P6<-matrix(c(m,o,t,r,w,0,w1),7,1)
P7<-matrix(c(l,p,u,s,f1,w1,0),7,1)


MD<-matrix(cbind(A1,B2,C3,D4,P5,P6,P7),7,7)
md<-as.dist(MD)
md
}

####################################################################################

cl2<-function(A,B,C,V,E,F,G,h,k)
{
a<-D2(A,B,h,k)
b<-D2(A,C,h,k)
y<-D2(A,V,h,k)
d<-D2(A,E,h,k)
m<-D2(A,F,h,k)
l<-D2(A,G,h,k)
e<-D2(B,C,h,k)
g<-D2(B,V,h,k)
h<-D2(B,E,h,k)
o<-D2(B,F,h,k)
p<-D2(B,G,h,k)
q<-D2(C,V,h,k)
z<-D2(C,E,h,k)
t<-D2(C,F,h,k)
u<-D2(C,G,h,k)
n<-D2(V,E,h,k)
r<-D2(V,F,h,k)
s<-D2(V,G,h,k)
w<-D2(E,F,h,k)
f1<-D2(E,G,h,k)
w1<-D2(F,G,h,k)

A1<-matrix(c(0,a,b,y,d,m,l),7,1)
B2<-matrix(c(a,0,e,g,h,o,p),7,1)
C3<-matrix(c(b,e,0,q,z,t,u),7,1)
D4<-matrix(c(y,g,q,0,n,r,s),7,1)
P5<-matrix(c(d,h,z,n,0,w,f1),7,1)
P6<-matrix(c(m,o,t,r,w,0,w1),7,1)
P7<-matrix(c(l,p,u,s,f1,w1,0),7,1)


MD<-matrix(cbind(A1,B2,C3,D4,P5,P6,P7),7,7)
md<-as.dist(MD)
md
}

###########################Funcion que transforma matriz de distancia
en objeto dist para DE##################
m_d<-function(A,B,C,V,E,F,G)
{
a<-de(A,B)
b<-de(A,C)
y<-de(A,V)
d<-de(A,E)
m<-de(A,F)
l<-de(A,G)
e<-de(B,C)
g<-de(B,V)
h<-de(B,E)
o<-de(B,F)
p<-de(B,G)
q<-de(C,V)
z<-de(C,E)
t<-de(C,F)
u<-de(C,G)
n<-de(V,E)
r<-de(V,F)
s<-de(V,G)
w<-de(E,F)
f1<-de(E,G)
w1<-de(F,G)

A1<-matrix(c(0,a,b,y,d,m,l),7,1)
B2<-matrix(c(a,0,e,g,h,o,p),7,1)
C3<-matrix(c(b,e,0,q,z,t,u),7,1)
D4<-matrix(c(y,g,q,0,n,r,s),7,1)
P5<-matrix(c(d,h,z,n,0,w,f1),7,1)
P6<-matrix(c(m,o,t,r,w,0,w1),7,1)
P7<-matrix(c(l,p,u,s,f1,w1,0),7,1)


MD<-matrix(cbind(A1,B2,C3,D4,P5,P6,P7),7,7)
md<-as.dist(MD)
md
}
#####################################################################
m_df<-function(A,B,C,V,E,F,G)
{
a<-df(A,B)
b<-df(A,C)
y<-df(A,V)
d<-df(A,E)
m<-df(A,F)
l<-df(A,G)
e<-df(B,C)
g<-df(B,V)
h<-df(B,E)
o<-df(B,F)
p<-df(B,G)
q<-df(C,V)
z<-df(C,E)
t<-df(C,F)
u<-df(C,G)
n<-df(V,E)
r<-df(V,F)
s<-df(V,G)
w<-df(E,F)
f1<-df(E,G)
w1<-df(F,G)

A1<-matrix(c(0,a,b,y,d,m,l),7,1)
B2<-matrix(c(a,0,e,g,h,o,p),7,1)
C3<-matrix(c(b,e,0,q,z,t,u),7,1)
D4<-matrix(c(y,g,q,0,n,r,s),7,1)
P5<-matrix(c(d,h,z,n,0,w,f1),7,1)
P6<-matrix(c(m,o,t,r,w,0,w1),7,1)
P7<-matrix(c(l,p,u,s,f1,w1,0),7,1)


MD<-matrix(cbind(A1,B2,C3,D4,P5,P6,P7),7,7)
md<-as.dist(MD)
md
}
###########################################################
m_dtw<-function(A,B,C,V,E,F,G)
{
a<-dtw(A,B)$distance
b<-dtw(A,C)$distance
y<-dtw(A,V)$distance
d<-dtw(A,E)$distance
m<-dtw(A,F)$distance
l<-dtw(A,G)$distance
e<-dtw(B,C)$distance
g<-dtw(B,V)$distance
h<-dtw(B,E)$distance
o<-dtw(B,F)$distance
p<-dtw(B,G)$distance
q<-dtw(C,V)$distance
z<-dtw(C,E)$distance
t<-dtw(C,F)$distance
u<-dtw(C,G)$distance
n<-dtw(V,E)$distance
r<-dtw(V,F)$distance
s<-dtw(V,G)$distance
w<-dtw(E,F)$distance
f1<-dtw(E,G)$distance
w1<-dtw(F,G)$distance

A1<-matrix(c(0,a,b,y,d,m,l),7,1)
B2<-matrix(c(a,0,e,g,h,o,p),7,1)
C3<-matrix(c(b,e,0,q,z,t,u),7,1)
D4<-matrix(c(y,g,q,0,n,r,s),7,1)
P5<-matrix(c(d,h,z,n,0,w,f1),7,1)
P6<-matrix(c(m,o,t,r,w,0,w1),7,1)
P7<-matrix(c(l,p,u,s,f1,w1,0),7,1)


MD<-matrix(cbind(A1,B2,C3,D4,P5,P6,P7),7,7)
md<-as.dist(MD)
md
}
#######################################################
m_cod<-function(A,B,C,V,E,F,G,h)
{
a<-cod(A,B,h)
b<-cod(A,C,h)
y<-cod(A,V,h)
d<-cod(A,E,h)
m<-cod(A,F,h)
l<-cod(A,G,h)
e<-cod(B,C,h)
g<-cod(B,V,h)
h<-cod(B,E,h)
o<-cod(B,F,h)
p<-cod(B,G,h)
q<-cod(C,V,h)
z<-cod(C,E,h)
t<-cod(C,F,h)
u<-cod(C,G,h)
n<-cod(V,E,h)
r<-cod(V,F,h)
s<-cod(V,G,h)
w<-cod(E,F,h)
f1<-cod(E,G,h)
w1<-cod(F,G,h)

A1<-matrix(c(0,a,b,y,d,m,l),7,1)
B2<-matrix(c(a,0,e,g,h,o,p),7,1)
C3<-matrix(c(b,e,0,q,z,t,u),7,1)
D4<-matrix(c(y,g,q,0,n,r,s),7,1)
P5<-matrix(c(d,h,z,n,0,w,f1),7,1)
P6<-matrix(c(m,o,t,r,w,0,w1),7,1)
P7<-matrix(c(l,p,u,s,f1,w1,0),7,1)


MD<-matrix(cbind(A1,B2,C3,D4,P5,P6,P7),7,7)
md<-as.dist(MD)
md
}
#####################################################################################
#series_corr<-function(p,q)
#{
rho<-0.9
rho1<-0.7
N<-200 # number of observations
phi1<-(-0.5)
phi2<-0.3
phi3<-(-0.8)
phi4<-0.7
phi5<-0.1
phi6<-(-0.9)
phi7<-0.2
x1<-matrix(0,nrow=N,ncol=1)
x2<-matrix(0,nrow=N,ncol=1)
x3<-matrix(0,nrow=N,ncol=1)
x4<-matrix(0,nrow=N,ncol=1)
x5<-matrix(0,nrow=N,ncol=1)
x6<-matrix(0,nrow=N,ncol=1)
x7<-matrix(0,nrow=N,ncol=1)
e1<-matrix(rnorm(N,0,1),N,1)
e2<-matrix(rnorm(N,0,1),N,1)
e3<-matrix(0,N,1)
e4<-matrix(0,N,1)
e5<-matrix(rnorm(N,0,1),N,1)
e6<-matrix(rnorm(N,0,1),N,1)
e7<-matrix(rnorm(N,0,1),N,1)
e8<-matrix(rnorm(N,0,1),N,1)
for (k in 1:N)
   {
      e3[k]<-rho*e1[k]+sqrt(1-rho^2)*e2[k]
      e4[k]<-rho1*e1[k]+sqrt(1-rho1^2)*e2[k]
	    x1[1]<-e1[1]
    	x2[1]<-e3[1]
      x3[1]<-e4[1]
      x4[1]<-e5[1]
      x5[1]<-e6[1]
      x6[1]<-e7[1]
      x7[1]<-e8[1]
   }
      for (j in 2:N)
      {
      x1[j]<-phi1*x1[j-1]+e1[j]
	    x2[j]<-phi2*x2[j-1]+e3[j]
      x3[j]<-phi3*x3[j-1]+e4[j]
 	    x4[j]<-phi4*x4[j-1]+e5[j]
 	    x5[j]<-phi5*x5[j-1]+e6[j]
 	    x6[j]<-phi6*x6[j-1]+e7[j]
 	    x7[j]<-phi7*x7[j-1]+e8[j]
      }
r<-matrix(cbind(x1,x2,x3,x4,x5,x6,x7),N,7)
ts.plot(r,xlab="Tiempo",ylab="Series",main="Gráfico Series Simuladas")
#}
#ts.plot(r)
##################################################################################
##################################################################################
x<-as.data.frame(X)
boxplot(x,names=c("Cup","Hab","Mag","Pla","Pro","Sta Ma","Sum"),xlab="AFP",
ylab="Renatbilidad", main="Cajón con bigotes")


########################Vectorizamos#################################################
l<-170
v1<-matrix(0,nrow=l,ncol=1)
v2<-matrix(0,nrow=l,ncol=1)
v3<-matrix(0,nrow=l,ncol=1)
v4<-matrix(0,nrow=l,ncol=1)
v5<-matrix(0,nrow=l,ncol=1)
v6<-matrix(0,nrow=l,ncol=1)
v7<-matrix(0,nrow=l,ncol=1)

for(i in 1:l)
  {
   v1[i]<-X[i,1]
   v2[i]<-X[i,2]
   v3[i]<-X[i,3]
   v4[i]<-X[i,4]
   v5[i]<-X[i,5]
   v6[i]<-X[i,6]
   v7[i]<-X[i,7]
   }

v11<-ts(v1,start=c(1990,1),frequency=12)
v21<-ts(v2,start=c(1990,1),frequency=12)
v31<-ts(v3,start=c(1990,1),frequency=12)
v41<-ts(v4,start=c(1990,1),frequency=12)
v51<-ts(v5,start=c(1990,1),frequency=12)
v61<-ts(v6,start=c(1990,1),frequency=12)
v71<-ts(v7,start=c(1990,1),frequency=12)

ts.plot(v11,xlab="Tiempo",ylab="Rentabilidad",main="AFP Cuprum")
ts.plot(v21,xlab="Tiempo",ylab="Rentabilidad",main="AFP Habitat")
ts.plot(v31,xlab="Tiempo",ylab="Rentabilidad",main="AFP Magister")
ts.plot(v41,xlab="Tiempo",ylab="Rentabilidad",main="AFP Planvital")
ts.plot(v51,xlab="Tiempo",ylab="Rentabilidad",main="AFP Provida")
ts.plot(v61,xlab="Tiempo",ylab="Rentabilidad",main="AFP Sta María")
ts.plot(v71,xlab="Tiempo",ylab="Rentabilidad",main="AFP Summa")

##################Transformaciones######################################################
t0<-v1+10
t1<-log(t0^0.5)
#t2<-diff(t1)

t3<-v2+10
t4<-log(t3^0.5)
#t5<-diff(t4)

t6<-v3+16
t7<-log(t6^0.5)
#t8<-diff(t7)

t9<-v4+10
t10<-log(t9^0.5)
#t11<-diff(t10)

t12<-v5+10
t13<-log(t12^0.5)
#t14<-diff(t3)

t15<-v6+12
t16<-log(t15^0.5)
#t17<-diff(t16)

t18<-v7+12
t19<-log(t18^0.5)
#t20<-diff(t19)

ts.plot(t1,xlab="Tiempo",ylab="Rentabilidad",main="AFP Cuprum Transformada")
ts.plot(t4,xlab="Tiempo",ylab="Rentabilidad",main="AFP Habitat Transformada")
ts.plot(t7,xlab="Tiempo",ylab="Rentabilidad",main="AFP Magister Transformada")
ts.plot(t10,xlab="Tiempo",ylab="Rentabilidad",main="AFP Planvital Transformada")
ts.plot(t13,xlab="Tiempo",ylab="Rentabilidad",main="AFP Provida Transformada")
ts.plot(t16,xlab="Tiempo",ylab="Rentabilidad",main="AFP Sta María Transformada")
ts.plot(t19,xlab="Tiempo",ylab="Rentabilidad",main="AFP Summa Transformada")
##########################Funcion ACF y PACF#################################

a1<-acf(t1,xlab="Retardo",ylab="ACF",main="AFP Cuprum")
a2<-acf(t4,xlab="Retardo",ylab="ACF",main="AFP Habitat")
a3<-acf(t7,xlab="Retardo",ylab="ACF",main="AFP Magister")
a4<-acf(t10,xlab="Retardo",ylab="ACF",main="AFP Planvital")
a5<-acf(t13,xlab="Retardo",ylab="ACF",main="AFP Provida")
a6<-acf(t16,xlab="Retardo",ylab="ACF",main="AFP Sta María")
a7<-acf(t19,xlab="Retardo",ylab="ACF",main="AFP Summa")



pa1<-pacf(t1,xlab="Retardo",ylab=" Partial ACF",main="AFP Cuprum")
pa2<-pacf(t4,xlab="Retardo",ylab="Partial ACF",main="AFP Habitat")
pa3<-pacf(t7,xlab="Retardo",ylab="Partial ACF",main="AFP Magister")
pa4<-pacf(t10,xlab="Retardo",ylab="Partial ACF",main="AFP Planvital")
pa5<-pacf(t13,xlab="Retardo",ylab="Partial ACF",main="AFP Provida")
pa6<-pacf(t16,xlab="Retardo",ylab="Partial ACF",main="AFP Sta María")
pa7<-pacf(t19,xlab="Retardo",ylab="Partial ACF",main="AFP Summa")

#######################Modelos Propuestos###################################
m0<-arima(t1,order=c(1,0,1))
m01<-arima(t1,order=c(0,0,1))
m02<-arima(t1,order=c(2,0,1))

m1<-arima(t1,order=c(0,0,1))
m1
m2<-arima(t4,order=c(0,0,1))
m2
m3<-arima(t7,order=c(0,0,1))
m3
m4<-arima(t10,order=c(0,0,1))
m4
m5<-arima(t13,order=c(0,0,1))
m5
m6<-arima(t16,order=c(0,0,1))
m6
m7<-arima(t19,order=c(0,0,1))
m7
###########################Residuos#######################################
tsdiag(m1)
tsdiag(m2)
tsdiag(m3)
tsdiag(m4)
tsdiag(m5)
tsdiag(m6)
tsdiag(m7)

shapiro.test(m1$residual)
shapiro.test(m2$residual)
shapiro.test(m3$residual)
shapiro.test(m4$residual)
shapiro.test(m5$residual)
shapiro.test(m6$residual)
shapiro.test(m7$residual)
\end{verbatim} 